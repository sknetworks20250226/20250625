{% extends "base.html" %}
{% block title %}myapp index{% endblock %}

{% block body %}
<div class="container mt-5">
    <div class="list-group">
    {% for post in posts %}       
        <a href="#" class="list-group-item list-group-item-action post-link" data-id="{{ post.id }}">            
            {{ post.title }} - {{ post.created_at|date:'Y-m-d H:i' }}
        </a> 
        <textarea class="post-detail form-control" style="display:none"></textarea>
    {% empty %}
        게시글이 없습니다.
    {% endfor %}
    </div>
</div>

<script>
function autoResizeTextarea($textarea) {
    $textarea.height(0); // 높이 초기화
    $textarea.height($textarea[0].scrollHeight); // 실제 내용 높이로 조정
}
$(function() {
    $('.post-link').on('click', function(e) {
        e.preventDefault();
        var $link = $(this);
        var postId = $link.data('id');
        var $detailDiv = $link.next('.post-detail');
        if ($detailDiv.is(':visible')) {
            $detailDiv.slideUp();
            return;
        }
        $.ajax({
            url: '/myapp/detail',
            method: 'GET',
            data: { id: postId },
            success: function(data) {
                $detailDiv.html(data.content).slideDown();
                autoResizeTextarea($textarea);
            },
            error: function() {
                $detailDiv.html('<div class="text-danger">상세 정보를 불러오지 못했습니다.</div>').slideDown();
            }
        });
    });
});
</script>

{% endblock %}




